function EventEmitter(){this.events={}}function Helper(){}function App(){this.url="/countries",this.countries=new Countries,this.cities=new Cities,this.resp=new Resp(document.querySelector("#response")),this.dataForServer={},this.init()}function Countries(){this.el=document.querySelector("#countries"),this.elToAdd=this.el.querySelector("#countries-list"),this.elForAdd=this.el.querySelector("#country-input"),this.elBtn=this.el.querySelector("#country-btn"),this.events=new EventEmitter,this.init()}function Resp(t){t&&(this.el=t,this.elToResp=this.el.querySelector("#data-for-response"),this.addBtn=this.el.querySelector("#response-add-data"),this.removeBtn=this.el.querySelector("#response-remove-data"),this.clearBtn=this.el.querySelector("#response-clear-data"),this.events=new EventEmitter,this.init())}function Cities(){this.el=document.querySelector("#cities"),this.elToAdd=this.el.querySelector("#cities-list"),this.elForAdd=this.el.querySelector("#city-input"),this.elBtn=this.el.querySelector("#city-btn"),this.events=new EventEmitter,this.init()}EventEmitter.prototype.on=function(t,e){"object"!=typeof this.events[t]&&(this.events[t]=[]),this.events[t].push(e)},EventEmitter.prototype.emit=function(t){if("object"==typeof this.events[t])for(var e=[].slice.call(arguments,1),i=this.events[t].slice(),s=i.length,n=0;n<s;n++)i[n].apply(this,e)},EventEmitter.prototype.removeListener=function(t,e){if("object"==typeof this.events[t]){var i=this.events[t].indexOf(e);i!==-1&&this.events[t].splice(i,1)}},Helper.prototype.XMLLoad=function(t,e,i,s,n){"use strict";var o=new XMLHttpRequest;o.addEventListener("readystatechange",function(){4==o.readyState&&200==o.status&&i(o.responseText)}),o.open(t,e,!0),o.setRequestHeader("Content-type",n||"application/x-www-form-urlencoded"),o.send(s||null)},App.prototype=Object.create(Helper.prototype),App.prototype.init=function(){this.XMLLoad("GET",this.url,this.addDatafromDatabase.bind(this)),this.countries.on("list-select-countries",this.chooseCountries.bind(this))},App.prototype.addDatafromDatabase=function(t){for(var t=JSON.parse(t),e=0;e<t.length;e++)this.helperAddDatafromDatabase(t[e])},App.prototype.helperAddDatafromDatabase=function(t){this.countries.addCountry(t.id);var e=t.cities;if(e)for(var i=0;i<e.length;i++)this.cities.addCity(e[i],t.id)},App.prototype.chooseCountries=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].innerHTML);this.cities.chooseInListShow(e)},window.addEventListener("DOMContentLoaded",function(){new App}),Countries.prototype={init:function(){this.el.addEventListener("click",this.delegationClick.bind(this)),this.el.addEventListener("keyup",this.delegationKeyup.bind(this))},delegationClick:function(t){var e=t.target;"LI"===e.tagName&&this.selectCountry(e),e===this.elBtn&&this.selectCountry()},delegationKeyup:function(t){t.target;if(this.findInList(this.elForAdd.value),13===t.keyCode){var e=this.elToAdd.querySelector(".show-list");this.selectCountry(e)}},selectCountry:function(t){var e=t?t.innerHTML:this.elForAdd.value;this.removeAllSelect(),t&&t.classList.add("selected"),this.emit("country-select",e)},removeAllSelect:function(){for(var t=this.elToAdd.children,e=0;e<t.length;e++)t[e].classList.remove("selected")},addCountry:function(t){"string"==typeof t&&""!==t&&this.elToAdd.insertAdjacentHTML("beforeend","<li show>"+t+"</li>")},findInList:function(t){this.activeDeactiveBtn(""!==t);var e=this.elToAdd.children;this.hideAll();for(var i=0;i<e.length;i++)e[i].innerHTML.toLowerCase().indexOf(t.toLowerCase())!==-1&&(e[i].classList.remove("hide"),e[i].classList.add("show-list"));var s=this.elToAdd.querySelectorAll(".show-list");this.emit("list-select-countries",s)},hideAll:function(){for(var t=this.elToAdd.children,e=0;e<t.length;e++)t[e].classList.remove("show-list","selected"),t[e].classList.add("hide")},activeDeactiveBtn:function(t){t?this.elBtn.removeAttribute("disabled"):this.elBtn.setAttribute("disabled","disabled")},clearAllList:function(){for(;this.elToAdd.firstChild;)this.elToAdd.removeChild(this.elToAdd.firstChild)},emit:function(t,e){this.events.emit(t,e)},on:function(t,e){this.events.on(t,e)}},Resp.prototype={init:function(){this.el.addEventListener("click",this.delegationClick.bind(this))},delegationClick:function(t){var e=t.target;e===this.addBtn&&this.emit("resp-add"),e===this.removeBtn&&this.emit("resp-del"),e===this.clearBtn&&this.emit("resp-clear")},showData:function(t){""===t&&(t="country: ; city: ;"),this.elToResp.innerHTML=t},checkBtns:function(t){var e={add:function(){this.addBtn.setAttribute("disabled","disabled"),this.removeBtn.setAttribute("disabled","disabled")},remove:function(){this.addBtn.removeAttribute("disabled"),this.removeBtn.removeAttribute("disabled")}};t?e.remove.call(this):e.add.call(this)},emit:function(t,e){this.events.emit(t,e)},on:function(t,e){this.events.on(t,e)}},Cities.prototype={init:function(){this.el.addEventListener("click",this.delegationClick.bind(this)),this.el.addEventListener("keyup",this.delegationKeyup.bind(this))},delegationClick:function(t){var e=t.target;"LI"===e.tagName&&this.selectCity(e),e===this.elBtn&&this.selectCity()},delegationKeyup:function(t){t.target;if(this.findInList(this.elForAdd.value),13===t.keyCode){var e=this.elToAdd.querySelector(".show-list");this.selectCity(e)}},selectCity:function(t){var e=t?t.innerHTML:this.elForAdd.value;this.removeAllSelect(),t&&t.classList.add("selected"),this.emit("city-select",e)},removeAllSelect:function(){for(var t=this.elToAdd.children,e=0;e<t.length;e++)t[e].classList.remove("selected")},addCity:function(t,e){this.elToAdd.insertAdjacentHTML("beforeend",'<li show country-name="'+e+'">'+t+"</li>")},clearAllList:function(){for(;this.elToAdd.firstChild;)this.elToAdd.removeChild(this.elToAdd.firstChild)},hideAll:function(){for(var t=this.elToAdd.children,e=0;e<t.length;e++)t[e].classList.add("hide"),t[e].classList.remove("show-list","selected")},findInList:function(t){this.activeDeactiveBtn(""!==t);var e=this.getByAttribute("show");this.hideAll();for(var i=0;i<e.length;i++)e[i].innerHTML.toLowerCase().indexOf(t.toLowerCase())!==-1&&(e[i].classList.remove("hide"),e[i].classList.add("show-list"));var s=this.elToAdd.querySelectorAll(".show-list");this.emit("list-select-cities",s)},activeDeactiveBtn:function(t){t?this.elBtn.removeAttribute("disabled"):this.elBtn.setAttribute("disabled","disabled")},setAllShow:function(){for(var t=this.elToAdd.children,e=0;e<t.length;e++)t[e].setAttribute("show","")},chooseInListShow:function(t){function e(t){return function(e,i,s){for(var i=0;i<t.length;i++)e===t[i].getAttribute("country-name")?(t[i].classList.remove("hide"),t[i].classList.add("show-list"),t[i].setAttribute("show","")):t[i].removeAttribute("show")}}this.hideAll();var i=this.elToAdd.children;t.forEach(e(i))},getByAttribute:function(t){for(var e=[],i=this.elToAdd.children,s=0;s<i.length;s++)i[s].hasAttribute(t)&&e.push(i[s]);return e},emit:function(t,e){this.events.emit(t,e)},on:function(t,e){this.events.on(t,e)}};